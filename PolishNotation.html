<!DOCTYPE html>
<html>
<body>
<script>
function infixToPostfix(infixexpr){
    prec = {};
	prec["^"] = 3;
    prec["*"] = 3;
    prec["/"] = 3;
    prec["+"] = 2;
    prec["-"] = 2;
    prec["("] = 1;
    opStack = [];
    postfixList = [];
    tokenList = infixexpr;
	tokenList.forEach(function(token,index){
		if(isNaN(token) == false)
		{
			postfixList.push(token);
		}else if(token == '('){
			opStack.push(token);
		}else if(token == ')'){
			topToken = opStack.pop();
			while(topToken != '(')
			{
				postfixList.push(topToken);
				topToken = opStack.pop();
			}
		}else{
			while (opStack.length > 0 && prec[opStack.slice(-1).pop()] >= prec[token])
					postfixList.push(opStack.pop());
					opStack.push(token);
		}
	});
    while (opStack.length > 0){
		postfixList.push(opStack.pop())
	}
    return postfixList.join(' ');
}

function postfixEval(postfixExpr){
    operandStack = [];
    tokenList = postfixExpr.split(' ');
    tokenList.forEach(function(token, index){
		if(isNaN(token) == false)
		{
			operandStack.push(Number(token));
		}else{
            operand2 = operandStack.pop();			
			operand1 = operandStack.pop()			
			var result;
			if(operand1 === undefined && operand2 !== undefined){
				if(token === "-")
				{
					result = operand2 * -1;
				}else if(token === "+"){
					result = operand2;
				} 
				else{
					throw "Illegal character";
				}
			}else{
				result = doMath(token,operand1,operand2);
			}
			operandStack.push(result);
		}
	});
    return operandStack.pop()
};

function doMath(op, op1, op2){
    if (op == "*")
        return op1 * op2
    else if (op == "/")
        return op1 / op2
	else if (op == "^"){
        return Math.pow(op1, op2)
		}
    else if (op == "+")
        return op1 + op2
    else
        return op1 - op2
};


function calculator()
{
	calculations =[];
	calculations.push("(2*-2)+(4*4)");
	calculations.push("( 1 + - 4 ) * 6 - ( .3 - 1 ) * ( 1 + 8 )");
	calculations.push("( 1 + 4 ) * ( 6 + 3 )");
	calculations.push("( 1 + 4 ) * 6");
	calculations.push("1 + 4 * 6");
	calculations.push("- ( 2 * 2 ) ^ 2");
	calculations.push("+ ( 2 * 2 ) ^ 2");
	calculations.push("( 1.2 * 2.4 ) ^ 2");
	calculations.push("( ( 2 * 2 ) + ( 4 * 4 ) ) ^ 2");
	calculations.forEach(function(calculation, index){
		console.log(calculation);
		console.log(postfixEval(infixToPostfix(stringToArray(calculation))));
	});
}

function stringToArray(str)
{
	tokenList = [];
		var checklist = '*^+-/';
		var numbers = [];
		var postfix = [];
		for(var i =0; i < str.length; i++)
		{
			if(str[i] === ' ')
				continue;
			else if(checklist.indexOf(str[i]) > -1)
			{
				postfix.push(str[i]);
				if(numbers.length > 0)
				{
					tokenList.push(numbers.join(''));
					numbers =[];
				}
				if(postfix.length === 1)
				{
					tokenList.push(str[i]);					
				}
			}else if(str[i] === '(' || str[i] === ')'){
				if(numbers.length > 0)
				{
					tokenList.push(numbers.join(''));
					numbers =[];
				}
				tokenList.push(str[i]);
			}else{	
				if(postfix.length === 2)
				{
					numbers.push(postfix.pop());
				}else if(postfix.length > 2)
				{
					throw "Illegal character";
				}
				numbers.push(str[i]);
				if(i == str.length-1)
				{
					tokenList.push(numbers.join(''));
				}
				postfix = [];
			}
		}
	return tokenList;
}
calculator();
</script>
</body>
</html> 